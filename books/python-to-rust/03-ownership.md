---
title: "第3章：Rust の所有権と借用ってなに？"
free: true
---

## まずは Python での感覚から

**ずんだもん**「Python って変数を関数に渡しても、元の変数はそのまま使えるのだ！」

```python
def modify(lst):
    lst.append(42)

a = [1, 2, 3]
modify(a)
print(a)  # [1, 2, 3, 42]
```

**めたん**「Python は参照渡しが基本だね。リストなどのミュータブルなオブジェクトは関数の中で変更されるの。」

## Haskell はイミュータブル前提

**つるぎ**「Haskell は全てがイミュータブル（**不変**）だから、そもそも変えるって概念がないんだよ。」

```haskell
modify xs = xs ++ [42]

main = print (modify [1,2,3])  -- [1,2,3,42]
```

**ずんだもん**「変数というより値を変えない関数なのだ！」

## Rust の所有権とムーブ

**めたん**「Rust は値の所有者が一人だけっていうルールがあって、関数に渡すと元の変数が使えなくなる場合があるよ。」

```rust
fn take_ownership(v: Vec<i32>) {
    println!("{:?}", v);
}

fn main() {
    let my_vec = vec![1, 2, 3];
    take_ownership(my_vec);
    // println!("{:?}", my_vec); // これはエラー！所有権が移動している
}
```

**ずんだもん**「えっ、渡したらもう使えないのだ！？」

**つるぎ**「Rust ではこれを**ムーブ**（move）って呼ぶの。リソースの安全な管理のために必要なんだよ。」

## 借用：参照で渡す

**めたん**「所有権を渡さずに使いたいなら、**借用**（参照）を使うよ！」

```rust
fn borrow(vec: &Vec<i32>) {
    println!("参照で見るだけ: {:?}", vec);
}

fn main() {
    let data = vec![10, 20, 30];
    borrow(&data);         // 借用
    println!("{:?}", data); // 所有権を保持したまま使える！
}
```

**ずんだもん**「`&` をつけるだけで借用できるのだ！便利！」

## 可変な借用（mutable borrow）

```rust
fn modify(vec: &mut Vec<i32>) {
    vec.push(99);
}

fn main() {
    let mut data = vec![1, 2, 3];
    modify(&mut data); // 可変借用
    println!("{:?}", data); // [1, 2, 3, 99]
}
```

**めたん**「ただし可変借用は同時に1つだけってルールがあるから注意ね。」


## まとめ：所有権はこう違う！

| 言語      | 所有権・変更の扱い        | 特徴                    |
| ------- | ---------------- | --------------------- |
| Python  | 参照渡し（破壊的変更可）     | わかりやすいけどバグの温床にも |
| Haskell | 完全イミュータブル        | 値は使い捨て、関数型思考にぴったり |
| Rust    | 所有権・ムーブ・借用の明示が必要 | エラーは出るが安全、高速で並行処理にも強い |


## もしもの話：所有権を忘れたずんだもん

**ずんだもん**「うっかり `Vec` を関数に渡して、あとで使おうとしたらエラーになって泣いたのだ…」

**めたん**「そういうときは、借用で渡すか、値を `clone` して渡すという選択肢があるよ。」

```rust
fn clone_and_use(v: Vec<i32>) {
    println!("{:?}", v);
}

fn main() {
    let original = vec![1, 2, 3];
    clone_and_use(original.clone());
    println!("{:?}", original); // 問題なく使える
}
```

**つるぎ**「けれど `clone` はコストがかかるから、必要なときだけ慎重に使うのが Rust 流だよ。」

## 【次回予告】

**ずんだもん**「Rust の所有権、ちょっと難しいけどおもしろいのだ！」

**めたん**「次は イテレータと `map/filter/collect` を、Python や Haskell と比較してみようか。」

**つるぎ**「関数型っぽい処理が Rust でも書けるって見ていこう！」
